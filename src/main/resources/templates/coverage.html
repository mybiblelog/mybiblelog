<!DOCTYPE html>
<html layout:decorate="~{layout}">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<title>My Bible Log</title>
</head>

<body>
	<div layout:fragment="content">

    <script type="text/x-template" id="completion-bar">
      <div :style="backgroundStyle">
        <div :style="foregroundStyle"></div>
      </div>
    </script>

    <script type="text/x-template" id="segment-bar">
      <div :style="backgroundStyle">
        <div v-for="segment in segments"
        :title="displayVerseRange(segment.startVerseId, segment.endVerseId)"
        :style="{
          width: segment.percentage + '%',
          height: '100%',
          background: segment.read ? foregroundColor : 'transparent',
          display: 'inline-block',
        }"></div>
      </div>
    </script>

    <script type="text/x-template" id="bible-report">
      <div>
        <header>
          <h2>Coverage Report</h2>
        </header>

        <div>
          <p>Total Bible Verses: {{ totalBibleVerses }}</p>
          <p>Unique Verses Read: {{ totalVersesRead }}</p>
          <p>Percent Complete: {{ percentageRead }}%</p>
        </div>
        
        <!--
          <completion-bar :percentage="percentageRead"></completion-bar>
        -->

        <segment-bar :segments="bibleReadingSegments"></segment-bar>

        <div class="coverage-list">
          <div class="coverage-card" v-for="report in allBookReports" @click="$emit('view-book-report', report.bookIndex)">
            <span class="coverage-card-book">{{ report.bookName }}</span>
            <span class="coverage-card-percentage">{{ report.percentage }}%</span>
            <div class="coverage-card-progress">
              <!-- <completion-bar :percentage="report.percentage"></completion-bar> -->
              <segment-bar :segments="bookReadingSegments(report.bookIndex)"></segment-bar>
            </div>
          </div>
        </div>
      </div>
    </script>
		
    <script type="text/x-template" id="book-report">
      <div>
        <header>
          <h2>Book Report: {{ book.name }}</h2>
          <button @click="$emit('exit-book-report')">Go Back</button>
        </header>

        <div>
          <p>Total Book Verses: {{ totalBookVerses }}</p>
          <p>Unique Verses Read: {{ totalVersesRead }}</p>
          <p>Percent Complete: {{ percentageRead }}%</p>
        </div>

        <completion-bar :percentage="percentageRead"></completion-bar>

        <table class="coverage-table">
          <thead>
            <tr>
              <th>Chapter</th>
              <th>Verses Read</th>
              <th>Total Verses</th>
              <th>Percent Complete</th>
            </tr>
          </thead>
          <template v-for="report in allChapterReports"> 
            <tr>
              <td>{{ report.chapterIndex }}</td>
              <td>{{ report.versesRead }}</td>
              <td>{{ report.totalVerses }}</td>
              <td>{{ report.percentage }}%</td>
            </tr>
            <tr>
              <td colspan=4>
                <completion-bar :percentage="report.percentage"></completion-bar>
              </td>
            </tr>
          </template>
        </table>
      </div>
    </script>
		
		<div id="js-vue-app" v-cloak class="page-column">
      <bible-report
        v-if="view == 'bible'"
        :log-entries="logEntries"
        @view-book-report="viewBookReport($event)"
        ></bible-report>
      <book-report
        v-if="view == 'book'"
        :log-entries="logEntries"
        :book-index="bookIndex"
        @exit-book-report="viewBibleReport"
        ></book-report>
    </div>
    
  </div>
  <div layout:fragment="bodyscripts">
    <script src="https://cdn.jsdelivr.net/npm/vue@2.5.17/dist/vue.js"></script>
    <script src="/js/coverage.vue.js"></script>
  </div>
</body>

</html>